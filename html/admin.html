<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Administrador de Mangas - White Pearl</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="../styles/admin.css">
</head>
<body class="bg-dark text-light p-4">

  <div class="container">
    <!-- Encabezado y botón de cerrar sesión -->
    <div class="admin-header d-flex justify-content-between align-items-center">
      <h1 class="mb-0">Panel de Administración</h1>
      <button id="btnLogout" class="btn btn-danger">Cerrar sesión</button>
    </div>

    <!-- Botones de navegación -->
    <div class="nav-buttons">
      <button id="btnNuevoManga" class="btn btn-outline-light">Nuevo Manga</button>
      <button id="btnSubirCapitulo" class="btn btn-outline-light">Subir Capítulo</button>
      <button id="btnActualizarManga" class="btn btn-outline-info">Actualizar Manga</button>
      <button id="btnGestionNoticias" class="btn btn-outline-warning">Noticias y Carrusel</button>
      <!-- Botones para Gestión -->
      <button id="btnEliminarContenido" class="btn btn-outline-danger">Eliminar Manga/Novela</button>
      <!-- Botones para Novelas -->
      <button id="btnNuevaNovela" class="btn btn-outline-success">Nueva Novela</button>
      <button id="btnSubirCapituloNovela" class="btn btn-outline-success">Subir Capítulo Novela</button>
      <button id="btnSubirVolumenNovela" class="btn btn-outline-success">Subir Volumen Novela</button>
    </div>

    <!-- Sección: Nuevo Manga -->
    <div id="nuevoMangaSection" class="admin-section d-none">
      <h3>Registrar Nuevo Manga</h3>
      <form id="formNuevoManga">
        <div class="mb-3">
          <label for="nombreManga" class="form-label">Nombre del manga</label>
          <input type="text" class="form-control" id="nombreManga" required />
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label for="portada" class="form-label">Portada (imagen a subir)</label>
              <input type="file" class="form-control" id="portada" accept="image/*" required />
            </div>
            <div class="mb-3">
              <label for="cloudinaryFolder" class="form-label">Ruta Cloudinary portada (opcional)</label>
              <input type="text" class="form-control" id="cloudinaryFolder" placeholder="Ej: mangas/nombreManga/portada" />
            </div>
          </div>
          <div class="col-md-6">
            <div class="mb-3">
              <label for="bannerManga" class="form-label">Banner para info del manga (opcional)</label>
              <input type="file" class="form-control" id="bannerManga" accept="image/*" />
              <div class="form-text">Banner que aparecerá en la página de información del manga</div>
            </div>
            <div class="mb-3">
              <label for="rutaBannerManga" class="form-label">Ruta Cloudinary banner (opcional)</label>
              <input type="text" class="form-control" id="rutaBannerManga" placeholder="Ej: mangas/nombreManga/banner" />
            </div>
          </div>
        </div>

        <div class="mb-3">
          <label for="sinopsis" class="form-label">Sinopsis</label>
          <textarea class="form-control" id="sinopsis" rows="3" required></textarea>
        </div>

        <div class="mb-3">
          <label for="autor" class="form-label">Autor</label>
          <input type="text" class="form-control" id="autor" required />
        </div>
        
        <label for="inputGenero">Género</label>
        <div class="d-flex gap-2 mb-2">
          <input id="inputGenero" type="text" class="form-control" placeholder="Escribe un género" autocomplete="off" />
        </div>
        <div id="listaGenerosSeleccionados" class="mb-3"></div>

        <div class="mb-3">
          <label for="estado" class="form-label">¿Está en emisión?</label>
          <select class="form-select" id="estado" required>
            <option value="" selected disabled>Selecciona una opción</option>
            <option value="En emisión">En emisión</option>
            <option value="Finalizado">Finalizado</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="frecuencia" class="form-label">Frecuencia de publicación</label>
          <select class="form-select" id="frecuencia" required>
            <option value="" selected disabled>Selecciona una opción</option>
            <option value="Semanal">Semanal</option>
            <option value="Mensual">Mensual</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="fechaLanzamiento" class="form-label">Fecha de lanzamiento</label>
          <input type="date" class="form-control" id="fechaLanzamiento" required />
        </div>

        <button type="submit" class="btn btn-success">Guardar Manga</button>
      </form>
    </div>

    <!-- Sección: Subir Capítulo -->
    <div id="subirCapituloSection" class="admin-section d-none">
      <h3>Subir Capítulo</h3>
      <form id="formSubirCapitulo">
        <div class="mb-3">
          <label for="mangaSeleccionado" class="form-label">Nombre del manga</label>
          <div class="position-relative">
            <input list="listaMangas" class="form-control" id="mangaSeleccionado" required autocomplete="off" />
          </div>
          <datalist id="listaMangas"></datalist>
        </div>

        <select id="capituloSeleccionado" class="form-select mb-2">
          <option value="">-- Selecciona un capítulo --</option>
        </select>
        <div id="capitulosExistentes" class="mt-2 text-info"></div>

        <div class="mb-3">
          <label for="numeroCapitulo" class="form-label">Número de capítulo</label>
          <input type="number" class="form-control" id="numeroCapitulo" required />
        </div>

        <div class="mb-3">
          <label for="imagenesCapitulo" class="form-label">Imágenes del capítulo</label>
          <input type="file" class="form-control" id="imagenesCapitulo" multiple required accept="image/*" />
        </div>

        <div class="mb-3">
          <label for="rutaCloudinary" class="form-label">Ruta en Cloudinary (opcional)</label>
          <input type="text" class="form-control" id="rutaCloudinary" placeholder="Ej: mangas/nombreManga/cap1" />
        </div>

        <button type="submit" class="btn btn-primary">Subir Capítulo</button>
      </form>
      <div id="progresoContainer" style="margin-top: 15px;"></div>
    </div>

    <!-- Sección: Actualizar Manga -->
    <div id="actualizarMangaSection" class="admin-section d-none">
      <h3>Actualizar Manga Existente</h3>
      
      <!-- Selección del manga -->
      <div class="mb-4">
        <label for="mangaActualizar" class="form-label">Seleccionar manga a actualizar</label>
        <div class="position-relative">
          <input list="listaMangasActualizar" class="form-control" id="mangaActualizar" placeholder="Escribe el nombre del manga" required autocomplete="off" />
        </div>
        <datalist id="listaMangasActualizar"></datalist>
        <div id="mangaSeleccionadoInfo" class="mt-3" style="display: none;">
          <div class="alert alert-info">
            <strong>Manga seleccionado:</strong> <span id="nombreMangaSeleccionado"></span>
            <br><small>Deja vacíos los campos que no quieras actualizar</small>
          </div>
        </div>
      </div>

      <form id="formActualizarManga">
        <!-- Información básica -->
        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label for="nombreMangaActual" class="form-label">Nuevo nombre (opcional)</label>
              <input type="text" class="form-control" id="nombreMangaActual" placeholder="Dejar vacío para mantener el actual" />
            </div>
            
            <div class="mb-3">
              <label for="autorActual" class="form-label">Nuevo autor (opcional)</label>
              <input type="text" class="form-control" id="autorActual" placeholder="Dejar vacío para mantener el actual" />
            </div>
            
            <div class="mb-3">
              <label for="estadoActual" class="form-label">Nuevo estado (opcional)</label>
              <select class="form-select" id="estadoActual">
                <option value="">Mantener estado actual</option>
                <option value="En emisión">En emisión</option>
                <option value="Finalizado">Finalizado</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label for="frecuenciaActual" class="form-label">Nueva frecuencia (opcional)</label>
              <select class="form-select" id="frecuenciaActual">
                <option value="">Mantener frecuencia actual</option>
                <option value="Semanal">Semanal</option>
                <option value="Mensual">Mensual</option>
              </select>
            </div>
          </div>
          
          <div class="col-md-6">
            <div class="mb-3">
              <label for="sinopsisActual" class="form-label">Nueva sinopsis (opcional)</label>
              <textarea class="form-control" id="sinopsisActual" rows="4" placeholder="Dejar vacío para mantener la actual"></textarea>
            </div>
            
            <div class="mb-3">
              <label for="fechaLanzamientoActual" class="form-label">Nueva fecha de lanzamiento (opcional)</label>
              <input type="date" class="form-control" id="fechaLanzamientoActual" />
            </div>
          </div>
        </div>

        <!-- Imagenes -->
        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label for="nuevaPortada" class="form-label">Nueva portada (opcional)</label>
              <input type="file" class="form-control" id="nuevaPortada" accept="image/*" />
              <div class="form-text">Solo selecciona si quieres cambiar la portada actual</div>
              <div id="portadaPreview" class="mt-2" style="display: none;">
                <img id="portadaPreviewImg" src="" alt="Preview" class="img-thumbnail" style="max-width: 150px;">
              </div>
            </div>
          </div>
          
          <div class="col-md-6">
            <div class="mb-3">
              <label for="nuevoBanner" class="form-label">Nuevo banner para info del manga (opcional)</label>
              <input type="file" class="form-control" id="nuevoBanner" accept="image/*" />
              <div class="form-text">Banner que aparecerá en la página de información del manga</div>
              <div id="bannerPreview" class="mt-2" style="display: none;">
                <img id="bannerPreviewImg" src="" alt="Preview" class="img-thumbnail" style="max-width: 200px; height: 100px; object-fit: cover;">
              </div>
            </div>
          </div>
        </div>

        <!-- Rutas Cloudinary -->
        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label for="rutaPortadaActual" class="form-label">Ruta Cloudinary para portada (opcional)</label>
              <input type="text" class="form-control" id="rutaPortadaActual" placeholder="Ej: mangas/nombreManga/portada" />
            </div>
          </div>
          <div class="col-md-6">
            <div class="mb-3">
              <label for="rutaBannerActual" class="form-label">Ruta Cloudinary para banner (opcional)</label>
              <input type="text" class="form-control" id="rutaBannerActual" placeholder="Ej: mangas/nombreManga/banner" />
            </div>
          </div>
        </div>

        <div class="d-flex gap-3">
          <button type="submit" class="btn btn-primary">Actualizar Manga</button>
          <button type="button" id="btnLimpiarFormActualizar" class="btn btn-secondary">Limpiar Formulario</button>
        </div>
      </form>
    </div>

    <!-- Sección: Noticias y Carrusel -->
    <div id="gestionNoticiasSection" class="admin-section d-none">
      <h3>Administrar Noticias y Carrusel</h3>

      <form id="formNoticia" class="mb-4">
        <div class="mb-3">
          <label for="textoNoticia" class="form-label">Texto de la noticia</label>
          <input type="text" class="form-control" id="textoNoticia" required />
        </div>
        <div class="mb-3">
          <label for="imagenNoticia" class="form-label">Imagen (opcional)</label>
          <input type="file" class="form-control" id="imagenNoticia" accept="image/*" />
        </div>
        <button type="submit" class="btn btn-success">Agregar Noticia</button>
      </form>

      <h5>Noticias existentes:</h5>
      <ul id="listaNoticias" class="list-group mb-4"></ul>

      <h5>Carrusel principal (máx. 5)</h5>
      <form id="formCarrusel" class="mb-4">
        <div class="mb-3">
          <label for="imagenCarrusel" class="form-label">Imagen carrusel</label>
          <input type="file" class="form-control" id="imagenCarrusel" accept="image/*" required />
        </div>
        <div class="mb-3">
          <label for="tituloCarrusel" class="form-label">Título</label>
          <input type="text" class="form-control" id="tituloCarrusel" />
        </div>
        <div class="mb-3">
          <label for="descripcionCarrusel" class="form-label">Descripción</label>
          <input type="text" class="form-control" id="descripcionCarrusel" />
        </div>
        <button type="submit" class="btn btn-primary">Agregar Imagen al Carrusel</button>
      </form>

      <ul id="listaCarrusel" class="list-group"></ul>
    </div>

    <!-- Sección: Eliminar Contenido -->
    <div id="eliminarContenidoSection" class="admin-section d-none">
      <h3>Eliminar Manga o Novela</h3>
      
      <div class="alert alert-danger" role="alert">
        <i class="bi bi-exclamation-triangle-fill"></i>
        <strong>¡ATENCIÓN!</strong> Esta acción es <strong>irreversible</strong>. Se eliminará completamente el contenido seleccionado junto con todos sus capítulos, comentarios y datos asociados.
      </div>

      <!-- Selección del tipo de contenido -->
      <div class="mb-4">
        <h5>Seleccionar tipo de contenido</h5>
        <div class="btn-group" role="group">
          <input type="radio" class="btn-check" name="tipoContenido" id="radioManga" value="manga" autocomplete="off" checked>
          <label class="btn btn-outline-primary" for="radioManga">Manga</label>
          
          <input type="radio" class="btn-check" name="tipoContenido" id="radioNovela" value="novela" autocomplete="off">
          <label class="btn btn-outline-success" for="radioNovela">Novela</label>
        </div>
      </div>

      <!-- Selección del contenido a eliminar -->
      <div class="mb-4">
        <label for="contenidoAEliminar" class="form-label">Seleccionar contenido a eliminar</label>
        <div class="position-relative">
          <input list="listaContenidoEliminar" class="form-control" id="contenidoAEliminar" placeholder="Escribe el nombre del manga o novela" required autocomplete="off" />
        </div>
        <datalist id="listaContenidoEliminar"></datalist>
        
        <div id="contenidoSeleccionadoInfo" class="mt-3" style="display: none;">
          <div class="alert alert-warning">
            <div class="row">
              <div class="col-md-8">
                <strong>Contenido seleccionado:</strong> <span id="nombreContenidoSeleccionado"></span><br>
                <strong>Tipo:</strong> <span id="tipoContenidoSeleccionado"></span><br>
                <strong>Capítulos:</strong> <span id="capitulosContenidoSeleccionado">0</span><br>
                <small class="text-muted">Todos los datos asociados serán eliminados permanentemente.</small>
              </div>
              <div class="col-md-4 text-end">
                <img id="portadaContenidoSeleccionado" src="" alt="Portada" class="img-thumbnail" style="max-width: 100px; display: none;">
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Confirmación de eliminación -->
      <div class="mb-4">
        <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" id="confirmarEliminacion">
          <label class="form-check-label text-warning" for="confirmarEliminacion">
            <strong>Confirmo que entiendo que esta acción es irreversible</strong>
          </label>
        </div>
        
        <div class="form-group mb-3">
          <label for="confirmacionTexto" class="form-label">Para confirmar, escribe <strong>"ELIMINAR"</strong> en el campo:</label>
          <input type="text" class="form-control" id="confirmacionTexto" placeholder="Escribe ELIMINAR para confirmar">
        </div>
      </div>

      <div class="d-flex gap-3">
        <button type="button" id="btnEliminarContenidoAccion" class="btn btn-danger" disabled>
          <i class="bi bi-trash-fill"></i> Eliminar Contenido
        </button>
        <button type="button" id="btnCancelarEliminacion" class="btn btn-secondary">
          <i class="bi bi-x-circle"></i> Cancelar
        </button>
      </div>
    </div>

    <!-- Sección: Nueva Novela -->
    <div id="nuevaNovelaSection" class="admin-section d-none">
      <h3>Registrar Nueva Novela</h3>
      <form id="formNuevaNovela">
        <div class="mb-3">
          <label for="nombreNovela" class="form-label">Nombre de la novela</label>
          <input type="text" class="form-control" id="nombreNovela" required />
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label for="portadaNovela" class="form-label">Portada (imagen a subir)</label>
              <input type="file" class="form-control" id="portadaNovela" accept="image/*" required />
            </div>
          </div>
        </div>

        <div class="mb-3">
          <label for="sinopsisNovela" class="form-label">Sinopsis</label>
          <textarea class="form-control" id="sinopsisNovela" rows="3" required></textarea>
        </div>

        <div class="mb-3">
          <label for="autorNovela" class="form-label">Autor</label>
          <input type="text" class="form-control" id="autorNovela" required />
        </div>
        
        <label for="inputGenero">Género</label>
        <div class="d-flex gap-2 mb-2">
          <input id="inputGenero" type="text" class="form-control" placeholder="Escribe un género" autocomplete="off" />
        </div>
        <div id="listaGenerosSeleccionados" class="mb-3"></div>

        <div class="mb-3">
          <label for="estadoNovela" class="form-label">¿Está en emisión?</label>
          <select class="form-select" id="estadoNovela" required>
            <option value="" selected disabled>Selecciona una opción</option>
            <option value="En emisión">En emisión</option>
            <option value="Finalizado">Finalizado</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="frecuenciaNovela" class="form-label">Frecuencia de publicación</label>
          <select class="form-select" id="frecuenciaNovela" required>
            <option value="" selected disabled>Selecciona una opción</option>
            <option value="Semanal">Semanal</option>
            <option value="Mensual">Mensual</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="fechaLanzamientoNovela" class="form-label">Fecha de lanzamiento</label>
          <input type="date" class="form-control" id="fechaLanzamientoNovela" required />
        </div>

        <button type="submit" class="btn btn-success">Guardar Novela</button>
      </form>
    </div>

    <!-- Sección: Subir Capítulo de Novela -->
    <div id="subirCapituloNovelaSection" class="admin-section d-none">
      <h3>Editor de Capítulos de Novela</h3>
      <div class="alert alert-info">
        <i class="fas fa-info-circle"></i>
        <strong>Nuevo Editor Avanzado:</strong> Ahora puedes usar nuestro editor completo estilo Wattpad con herramientas de formato, vista previa y guardado automático.
      </div>
      
      <div class="text-center">
        <button id="btnAbrirEditor" class="btn btn-success btn-lg">
          <i class="fas fa-edit"></i> Abrir Editor de Novelas
        </button>
      </div>
      
      <hr class="my-4">
      
      <details>
        <summary class="btn btn-outline-secondary mb-3">Usar Editor Simple (Clásico)</summary>
        
        <form id="formSubirCapituloNovela">
          <div class="mb-3">
            <label for="novelaseleccionada" class="form-label">Nombre de la novela</label>
            <div class="position-relative">
              <input list="listaNovelasCapitulo" class="form-control" id="novelaseleccionada" required autocomplete="off" />
            </div>
            <datalist id="listaNovelasCapitulo"></datalist>
          </div>

          <div class="mb-3">
            <label for="numeroCapituloNovela" class="form-label">Número de capítulo</label>
            <input type="number" class="form-control" id="numeroCapituloNovela" required />
          </div>

          <div class="mb-3">
            <label for="editorCapitulo" class="form-label">Contenido del Capítulo</label>
            <textarea class="form-control" id="editorCapitulo" rows="10"></textarea>
            <small class="text-muted">Para una mejor experiencia, usa el Editor Avanzado de arriba.</small>
          </div>

          <div class="mb-3">
              <label for="previewCapitulo" class="form-label">Preview</label>
              <div id="previewCapitulo" class="border p-2" style="min-height: 100px;"></div>
          </div>

          <div class="mb-3">
              <label for="imagenCapituloNovela" class="form-label">Subir Imagen</label>
              <input type="file" class="form-control" id="imagenCapituloNovela" accept="image/*" />
              <input type="text" class="form-control mt-2" id="enlaceImagenGenerado" readonly placeholder="Enlace de la imagen generada"/>
          </div>

          <button type="submit" class="btn btn-primary">Subir Capítulo de Novela</button>
        </form>
      </details>
    </div>

    <!-- Sección: Subir Volumen de Novela -->
    <div id="subirVolumenNovelaSection" class="admin-section d-none">
      <h3>Subir Volumen de Novela</h3>
      <form id="formSubirVolumenNovela">
        <div class="mb-3">
          <label for="novelaseleccionadaVolumen" class="form-label">Nombre de la novela</label>
          <div class="position-relative">
            <input list="listaNovelasVolumen" class="form-control" id="novelaseleccionadaVolumen" required autocomplete="off" />
          </div>
          <datalist id="listaNovelasVolumen"></datalist>
        </div>

        <div class="mb-3">
          <label for="numeroVolumenNovela" class="form-label">Número de volumen</label>
          <input type="number" class="form-control" id="numeroVolumenNovela" required />
        </div>

        <div class="mb-3">
          <label for="enlaceVolumen" class="form-label">Enlace de Mediafire</label>
          <input type="url" class="form-control" id="enlaceVolumen" placeholder="https://www.mediafire.com/...">
        </div>

        <button type="submit" class="btn btn-primary">Subir Volumen</button>
      </form>
    </div>

  </div>

  <!-- Scripts -->
  <script type="module" src="../java/auth.js"></script>
  <script type="module" src="../java/admin.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
